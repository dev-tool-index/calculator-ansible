---
- name: Create app folder
  become: yes
  become_method: sudo
  file:
    path: /opt/myapp/calcaulator-service
    state: directory
    owner: hliu
    group: hliu

- name: Download calculator-service.war
  get_url:
    url: https://jitpack.io/com/github/dev-tool-index/calculator-service/3.7/calculator-service-3.7.war
    dest: /opt/myapp/calcaulator-service/calculator-service.war
    checksum: sha1:9ea3b2edea824470bbd226e1d6a90631e4376c06

- name: Kill calculator-service
  command: pkill -9 -f "java -Dserver.port=8091 -jar"
  ignore_errors: True

- name: Start calculator-service
  shell: nohup java -Dserver.port=8091 -jar /opt/myapp/calcaulator-service/calculator-service.war >/dev/null 2>&1 &
  args:
    executable: /bin/bash
  environment:
    MONGODB_PORT_27017_TCP_ADDR: 127.0.0.1
  tags:
    - start-calculator-service
